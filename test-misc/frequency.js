import LABELS from '../eth-labels/db.js';
import {ens_normalize} from '@adraffy/ens-normalize';
import {explode_cp} from '@adraffy/ens-norm-uts46';
import {mkdirSync, writeFileSync} from 'node:fs';
import {hex_cp} from '../utils.js';
import {createHash} from 'node:crypto';

// [4aa0fbe1]
// apl stuff
// https://discuss.ens.domains/t/ens-name-normalization/8652/392
//let chars = explode_cp('â¡â¢â£â¤â¥â¨â©âªâ®â˜â™âšâ›âœâŒ¿â€â³â¸â´â·âµâ¹âºâ¶âŽ€âŽâŽ‚âŽƒâŽœâŽŸâŽ¢âŽ¥âŽ¨âŽªâŽ¬âŽ®âŽ¸âŽ¹â¿âœââžâŸâ â¡');

// [29ab077d]
// general punctuation
// https://discuss.ens.domains/t/ens-name-normalization/8652/396
//let chars = [0x2033,0x2034,0x2036,0x2037,0x2057,0x2016,0x2018,0x2019,0x201A,0x201B,0x201C,0x201D,0x201E,0x201F,0x2020,0x2021,0x2022,0x2023,0x2027,0x2030,0x2031,0x2032,0x2035,0x2038,0x2039,0x203A,0x203D,0x203F,0x2040,0x2041,0x2043,0x2045,0x2046,0x204A,0x204B,0x204C,0x204D,0x204E,0x204F,0x2050,0x2051,0x2052,0x2053,0x2054,0x2055,0x2056,0x2058,0x2059,0x205A,0x205B,0x205D,0x205E];

let chars = [
	0x1D6, // (Ç–) LATIN SMALL LETTER U WITH DIAERESIS AND MACRON => [75 308 304]
	0x1D8, // (Ç˜) LATIN SMALL LETTER U WITH DIAERESIS AND ACUTE => [75 308 301]
	0x1DA, // (Çš) LATIN SMALL LETTER U WITH DIAERESIS AND CARON => [75 308 30C]
	0x1DC, // (Çœ) LATIN SMALL LETTER U WITH DIAERESIS AND GRAVE => [75 308 300]
	0x1DF, // (ÇŸ) LATIN SMALL LETTER A WITH DIAERESIS AND MACRON => [61 308 304]
	0x1E1, // (Ç¡) LATIN SMALL LETTER A WITH DOT ABOVE AND MACRON => [61 307 304]
	0x1ED, // (Ç­) LATIN SMALL LETTER O WITH OGONEK AND MACRON => [6F 328 304]
	0x1FB, // (Ç») LATIN SMALL LETTER A WITH RING ABOVE AND ACUTE => [61 30A 301]
	0x22B, // (È«) LATIN SMALL LETTER O WITH DIAERESIS AND MACRON => [6F 308 304]
	0x22D, // (È­) LATIN SMALL LETTER O WITH TILDE AND MACRON => [6F 303 304]
	0x231, // (È±) LATIN SMALL LETTER O WITH DOT ABOVE AND MACRON => [6F 307 304]
	0x390, // (Î) GREEK SMALL LETTER IOTA WITH DIALYTIKA AND TONOS => [3B9 308 301]
	0x3B0, // (Î°) GREEK SMALL LETTER UPSILON WITH DIALYTIKA AND TONOS => [3C5 308 301]
	0x9CB, // (à§‹) BENGALI VOWEL SIGN O => [9C7 9BE]
	0x9CC, // (à§Œ) BENGALI VOWEL SIGN AU => [9C7 9D7]
	0xB48, // (à­ˆ) ORIYA VOWEL SIGN AI => [B47 B56]
	0xB4B, // (à­‹) ORIYA VOWEL SIGN O => [B47 B3E]
	0xB4C, // (à­Œ) ORIYA VOWEL SIGN AU => [B47 B57]
	0xBCA, // (à¯Š) TAMIL VOWEL SIGN O => [BC6 BBE]
	0xBCB, // (à¯‹) TAMIL VOWEL SIGN OO => [BC7 BBE]
	0xBCC, // (à¯Œ) TAMIL VOWEL SIGN AU => [BC6 BD7]
	0xC48, // (à±ˆ) TELUGU VOWEL SIGN AI => [C46 C56]
	0xCC0, // (à³€) KANNADA VOWEL SIGN II => [CBF CD5]
	0xCC7, // (à³‡) KANNADA VOWEL SIGN EE => [CC6 CD5]
	0xCC8, // (à³ˆ) KANNADA VOWEL SIGN AI => [CC6 CD6]
	0xCCA, // (à³Š) KANNADA VOWEL SIGN O => [CC6 CC2]
	0xCCB, // (à³‹) KANNADA VOWEL SIGN OO => [CC6 CC2 CD5]
	0xD4A, // (àµŠ) MALAYALAM VOWEL SIGN O => [D46 D3E]
	0xD4B, // (àµ‹) MALAYALAM VOWEL SIGN OO => [D47 D3E]
	0xD4C, // (àµŒ) MALAYALAM VOWEL SIGN AU => [D46 D57]
	0xDDA, // (à·š) SINHALA VOWEL SIGN DIGA KOMBUVA => [DD9 DCA]
	0xDDC, // (à·œ) SINHALA VOWEL SIGN KOMBUVA HAA AELA-PILLA => [DD9 DCF]
	0xDDD, // (à·) SINHALA VOWEL SIGN KOMBUVA HAA DIGA AELA-PILLA => [DD9 DCF DCA]
	0xDDE, // (à·ž) SINHALA VOWEL SIGN KOMBUVA HAA GAYANUKITTA => [DD9 DDF]
	0x1B3B, // (á¬») BALINESE VOWEL SIGN RA REPA TEDUNG => [1B3A 1B35]
	0x1B3D, // (á¬½) BALINESE VOWEL SIGN LA LENGA TEDUNG => [1B3C 1B35]
	0x1B40, // (á­€) BALINESE VOWEL SIGN TALING TEDUNG => [1B3E 1B35]
	0x1B41, // (á­) BALINESE VOWEL SIGN TALING REPA TEDUNG => [1B3F 1B35]
	0x1B43, // (á­ƒ) BALINESE VOWEL SIGN PEPET TEDUNG => [1B42 1B35]
	0x1E09, // (á¸‰) LATIN SMALL LETTER C WITH CEDILLA AND ACUTE => [63 327 301]
	0x1E15, // (á¸•) LATIN SMALL LETTER E WITH MACRON AND GRAVE => [65 304 300]
	0x1E17, // (á¸—) LATIN SMALL LETTER E WITH MACRON AND ACUTE => [65 304 301]
	0x1E1D, // (á¸) LATIN SMALL LETTER E WITH CEDILLA AND BREVE => [65 327 306]
	0x1E2F, // (á¸¯) LATIN SMALL LETTER I WITH DIAERESIS AND ACUTE => [69 308 301]
	0x1E39, // (á¸¹) LATIN SMALL LETTER L WITH DOT BELOW AND MACRON => [6C 323 304]
	0x1E4D, // (á¹) LATIN SMALL LETTER O WITH TILDE AND ACUTE => [6F 303 301]
	0x1E4F, // (á¹) LATIN SMALL LETTER O WITH TILDE AND DIAERESIS => [6F 303 308]
	0x1E51, // (á¹‘) LATIN SMALL LETTER O WITH MACRON AND GRAVE => [6F 304 300]
	0x1E53, // (á¹“) LATIN SMALL LETTER O WITH MACRON AND ACUTE => [6F 304 301]
	0x1E5D, // (á¹) LATIN SMALL LETTER R WITH DOT BELOW AND MACRON => [72 323 304]
	0x1E65, // (á¹¥) LATIN SMALL LETTER S WITH ACUTE AND DOT ABOVE => [73 301 307]
	0x1E67, // (á¹§) LATIN SMALL LETTER S WITH CARON AND DOT ABOVE => [73 30C 307]
	0x1E69, // (á¹©) LATIN SMALL LETTER S WITH DOT BELOW AND DOT ABOVE => [73 323 307]
	0x1E79, // (á¹¹) LATIN SMALL LETTER U WITH TILDE AND ACUTE => [75 303 301]
	0x1E7B, // (á¹») LATIN SMALL LETTER U WITH MACRON AND DIAERESIS => [75 304 308]
	0x1EA5, // (áº¥) LATIN SMALL LETTER A WITH CIRCUMFLEX AND ACUTE => [61 302 301]
	0x1EA7, // (áº§) LATIN SMALL LETTER A WITH CIRCUMFLEX AND GRAVE => [61 302 300]
	0x1EA9, // (áº©) LATIN SMALL LETTER A WITH CIRCUMFLEX AND HOOK ABOVE => [61 302 309]
	0x1EAB, // (áº«) LATIN SMALL LETTER A WITH CIRCUMFLEX AND TILDE => [61 302 303]
	0x1EAD, // (áº­) LATIN SMALL LETTER A WITH CIRCUMFLEX AND DOT BELOW => [61 323 302]
	0x1EAF, // (áº¯) LATIN SMALL LETTER A WITH BREVE AND ACUTE => [61 306 301]
	0x1EB1, // (áº±) LATIN SMALL LETTER A WITH BREVE AND GRAVE => [61 306 300]
	0x1EB3, // (áº³) LATIN SMALL LETTER A WITH BREVE AND HOOK ABOVE => [61 306 309]
	0x1EB5, // (áºµ) LATIN SMALL LETTER A WITH BREVE AND TILDE => [61 306 303]
	0x1EB7, // (áº·) LATIN SMALL LETTER A WITH BREVE AND DOT BELOW => [61 323 306]
	0x1EBF, // (áº¿) LATIN SMALL LETTER E WITH CIRCUMFLEX AND ACUTE => [65 302 301]
	0x1EC1, // (á») LATIN SMALL LETTER E WITH CIRCUMFLEX AND GRAVE => [65 302 300]
	0x1EC3, // (á»ƒ) LATIN SMALL LETTER E WITH CIRCUMFLEX AND HOOK ABOVE => [65 302 309]
	0x1EC5, // (á»…) LATIN SMALL LETTER E WITH CIRCUMFLEX AND TILDE => [65 302 303]
	0x1EC7, // (á»‡) LATIN SMALL LETTER E WITH CIRCUMFLEX AND DOT BELOW => [65 323 302]
	0x1ED1, // (á»‘) LATIN SMALL LETTER O WITH CIRCUMFLEX AND ACUTE => [6F 302 301]
	0x1ED3, // (á»“) LATIN SMALL LETTER O WITH CIRCUMFLEX AND GRAVE => [6F 302 300]
	0x1ED5, // (á»•) LATIN SMALL LETTER O WITH CIRCUMFLEX AND HOOK ABOVE => [6F 302 309]
	0x1ED7, // (á»—) LATIN SMALL LETTER O WITH CIRCUMFLEX AND TILDE => [6F 302 303]
	0x1ED9, // (á»™) LATIN SMALL LETTER O WITH CIRCUMFLEX AND DOT BELOW => [6F 323 302]
	0x1EDB, // (á»›) LATIN SMALL LETTER O WITH HORN AND ACUTE => [6F 31B 301]
	0x1EDD, // (á») LATIN SMALL LETTER O WITH HORN AND GRAVE => [6F 31B 300]
	0x1EDF, // (á»Ÿ) LATIN SMALL LETTER O WITH HORN AND HOOK ABOVE => [6F 31B 309]
	0x1EE1, // (á»¡) LATIN SMALL LETTER O WITH HORN AND TILDE => [6F 31B 303]
	0x1EE3, // (á»£) LATIN SMALL LETTER O WITH HORN AND DOT BELOW => [6F 31B 323]
	0x1EE9, // (á»©) LATIN SMALL LETTER U WITH HORN AND ACUTE => [75 31B 301]
	0x1EEB, // (á»«) LATIN SMALL LETTER U WITH HORN AND GRAVE => [75 31B 300]
	0x1EED, // (á»­) LATIN SMALL LETTER U WITH HORN AND HOOK ABOVE => [75 31B 309]
	0x1EEF, // (á»¯) LATIN SMALL LETTER U WITH HORN AND TILDE => [75 31B 303]
	0x1EF1, // (á»±) LATIN SMALL LETTER U WITH HORN AND DOT BELOW => [75 31B 323]
	0x1F02, // (á¼‚) GREEK SMALL LETTER ALPHA WITH PSILI AND VARIA => [3B1 313 300]
	0x1F03, // (á¼ƒ) GREEK SMALL LETTER ALPHA WITH DASIA AND VARIA => [3B1 314 300]
	0x1F04, // (á¼„) GREEK SMALL LETTER ALPHA WITH PSILI AND OXIA => [3B1 313 301]
	0x1F05, // (á¼…) GREEK SMALL LETTER ALPHA WITH DASIA AND OXIA => [3B1 314 301]
	0x1F06, // (á¼†) GREEK SMALL LETTER ALPHA WITH PSILI AND PERISPOMENI => [3B1 313 342]
	0x1F07, // (á¼‡) GREEK SMALL LETTER ALPHA WITH DASIA AND PERISPOMENI => [3B1 314 342]
	0x1F12, // (á¼’) GREEK SMALL LETTER EPSILON WITH PSILI AND VARIA => [3B5 313 300]
	0x1F13, // (á¼“) GREEK SMALL LETTER EPSILON WITH DASIA AND VARIA => [3B5 314 300]
	0x1F14, // (á¼”) GREEK SMALL LETTER EPSILON WITH PSILI AND OXIA => [3B5 313 301]
	0x1F15, // (á¼•) GREEK SMALL LETTER EPSILON WITH DASIA AND OXIA => [3B5 314 301]
	0x1F22, // (á¼¢) GREEK SMALL LETTER ETA WITH PSILI AND VARIA => [3B7 313 300]
	0x1F23, // (á¼£) GREEK SMALL LETTER ETA WITH DASIA AND VARIA => [3B7 314 300]
	0x1F24, // (á¼¤) GREEK SMALL LETTER ETA WITH PSILI AND OXIA => [3B7 313 301]
	0x1F25, // (á¼¥) GREEK SMALL LETTER ETA WITH DASIA AND OXIA => [3B7 314 301]
	0x1F26, // (á¼¦) GREEK SMALL LETTER ETA WITH PSILI AND PERISPOMENI => [3B7 313 342]
	0x1F27, // (á¼§) GREEK SMALL LETTER ETA WITH DASIA AND PERISPOMENI => [3B7 314 342]
	0x1F32, // (á¼²) GREEK SMALL LETTER IOTA WITH PSILI AND VARIA => [3B9 313 300]
	0x1F33, // (á¼³) GREEK SMALL LETTER IOTA WITH DASIA AND VARIA => [3B9 314 300]
	0x1F34, // (á¼´) GREEK SMALL LETTER IOTA WITH PSILI AND OXIA => [3B9 313 301]
	0x1F35, // (á¼µ) GREEK SMALL LETTER IOTA WITH DASIA AND OXIA => [3B9 314 301]
	0x1F36, // (á¼¶) GREEK SMALL LETTER IOTA WITH PSILI AND PERISPOMENI => [3B9 313 342]
	0x1F37, // (á¼·) GREEK SMALL LETTER IOTA WITH DASIA AND PERISPOMENI => [3B9 314 342]
	0x1F42, // (á½‚) GREEK SMALL LETTER OMICRON WITH PSILI AND VARIA => [3BF 313 300]
	0x1F43, // (á½ƒ) GREEK SMALL LETTER OMICRON WITH DASIA AND VARIA => [3BF 314 300]
	0x1F44, // (á½„) GREEK SMALL LETTER OMICRON WITH PSILI AND OXIA => [3BF 313 301]
	0x1F45, // (á½…) GREEK SMALL LETTER OMICRON WITH DASIA AND OXIA => [3BF 314 301]
	0x1F52, // (á½’) GREEK SMALL LETTER UPSILON WITH PSILI AND VARIA => [3C5 313 300]
	0x1F53, // (á½“) GREEK SMALL LETTER UPSILON WITH DASIA AND VARIA => [3C5 314 300]
	0x1F54, // (á½”) GREEK SMALL LETTER UPSILON WITH PSILI AND OXIA => [3C5 313 301]
	0x1F55, // (á½•) GREEK SMALL LETTER UPSILON WITH DASIA AND OXIA => [3C5 314 301]
	0x1F56, // (á½–) GREEK SMALL LETTER UPSILON WITH PSILI AND PERISPOMENI => [3C5 313 342]
	0x1F57, // (á½—) GREEK SMALL LETTER UPSILON WITH DASIA AND PERISPOMENI => [3C5 314 342]
	0x1F62, // (á½¢) GREEK SMALL LETTER OMEGA WITH PSILI AND VARIA => [3C9 313 300]
	0x1F63, // (á½£) GREEK SMALL LETTER OMEGA WITH DASIA AND VARIA => [3C9 314 300]
	0x1F64, // (á½¤) GREEK SMALL LETTER OMEGA WITH PSILI AND OXIA => [3C9 313 301]
	0x1F65, // (á½¥) GREEK SMALL LETTER OMEGA WITH DASIA AND OXIA => [3C9 314 301]
	0x1F66, // (á½¦) GREEK SMALL LETTER OMEGA WITH PSILI AND PERISPOMENI => [3C9 313 342]
	0x1F67, // (á½§) GREEK SMALL LETTER OMEGA WITH DASIA AND PERISPOMENI => [3C9 314 342]
	0x1FD2, // (á¿’) GREEK SMALL LETTER IOTA WITH DIALYTIKA AND VARIA => [3B9 308 300]
	0x1FD7, // (á¿—) GREEK SMALL LETTER IOTA WITH DIALYTIKA AND PERISPOMENI => [3B9 308 342]
	0x1FE2, // (á¿¢) GREEK SMALL LETTER UPSILON WITH DIALYTIKA AND VARIA => [3C5 308 300]
	0x1FE7, // (á¿§) GREEK SMALL LETTER UPSILON WITH DIALYTIKA AND PERISPOMENI => [3C5 308 342]
	0x1112E, // (ð‘„®) CHAKMA VOWEL SIGN O => [11131 11127]
	0x1112F, // (ð‘„¯) CHAKMA VOWEL SIGN AU => [11132 11127]
	0x1134B, // (ð‘‹) GRANTHA VOWEL SIGN OO => [11347 1133E]
	0x1134C, // (ð‘Œ) GRANTHA VOWEL SIGN AU => [11347 11357]
	0x114BB, // (ð‘’») TIRHUTA VOWEL SIGN AI => [114B9 114BA]
	0x114BC, // (ð‘’¼) TIRHUTA VOWEL SIGN O => [114B9 114B0]
	0x114BE, // (ð‘’¾) TIRHUTA VOWEL SIGN AU => [114B9 114BD]
	0x115BA, // (ð‘–º) SIDDHAM VOWEL SIGN O => [115B8 115AF]
	0x115BB, // (ð‘–») SIDDHAM VOWEL SIGN AU => [115B9 115AF]
	0x11938, // (ð‘¤¸) DIVES AKURU VOWEL SIGN O => [11935 11930]

	// mappings with multiple cm
	0x344, // (Í„) COMBINING GREEK DIALYTIKA TONOS => [308 301] => [308 301]
	0xF73, // (à½³) TIBETAN VOWEL SIGN II => [F71 F72] => [F71 F72]
	0xF75, // (à½µ) TIBETAN VOWEL SIGN UU => [F71 F74] => [F71 F74]
	0xF76, // (à½¶) TIBETAN VOWEL SIGN VOCALIC R => [FB2 F80] => [FB2 F80]
	0xF77, // (à½·) TIBETAN VOWEL SIGN VOCALIC RR => [FB2 F71 F80] => [FB2 F71 F80]
	0xF78, // (à½¸) TIBETAN VOWEL SIGN VOCALIC L => [FB3 F80] => [FB3 F80]
	0xF79, // (à½¹) TIBETAN VOWEL SIGN VOCALIC LL => [FB3 F71 F80] => [FB3 F71 F80]
	0xF81, // (à¾) TIBETAN VOWEL SIGN REVERSED II => [F71 F80] => [F71 F80]
	0xF93, // (à¾“) TIBETAN SUBJOINED LETTER GHA => [F92 FB7] => [F92 FB7]
	0xF9D, // (à¾) TIBETAN SUBJOINED LETTER DDHA => [F9C FB7] => [F9C FB7]
	0xFA2, // (à¾¢) TIBETAN SUBJOINED LETTER DHA => [FA1 FB7] => [FA1 FB7]
	0xFA7, // (à¾§) TIBETAN SUBJOINED LETTER BHA => [FA6 FB7] => [FA6 FB7]
	0xFAC, // (à¾¬) TIBETAN SUBJOINED LETTER DZHA => [FAB FB7] => [FAB FB7]
	0xFB9, // (à¾¹) TIBETAN SUBJOINED LETTER KSSA => [F90 FB5] => [F90 FB5]
	0xFB2C, // (ï¬¬) HEBREW LETTER SHIN WITH DAGESH AND SHIN DOT => [5E9 5BC 5C1] => [5E9 5BC 5C1]
	0xFB2D, // (ï¬­) HEBREW LETTER SHIN WITH DAGESH AND SIN DOT => [5E9 5BC 5C2] => [5E9 5BC 5C2]
	0xFCF2, // (ï³²) ARABIC LIGATURE SHADDA WITH FATHA MEDIAL FORM => [640 64E 651] => [640 64E 651]
	0xFCF3, // (ï³³) ARABIC LIGATURE SHADDA WITH DAMMA MEDIAL FORM => [640 64F 651] => [640 64F 651]
	0xFCF4, // (ï³´) ARABIC LIGATURE SHADDA WITH KASRA MEDIAL FORM => [640 650 651] => [640 650 651]
	0x1D160, // (ð… ) MUSICAL SYMBOL EIGHTH NOTE => [1D158 1D165 1D16E] => [1D158 1D165 1D16E]
	0x1D161, // (ð…¡) MUSICAL SYMBOL SIXTEENTH NOTE => [1D158 1D165 1D16F] => [1D158 1D165 1D16F]
	0x1D162, // (ð…¢) MUSICAL SYMBOL THIRTY-SECOND NOTE => [1D158 1D165 1D170] => [1D158 1D165 1D170]
	0x1D163, // (ð…£) MUSICAL SYMBOL SIXTY-FOURTH NOTE => [1D158 1D165 1D171] => [1D158 1D165 1D171]
	0x1D164, // (ð…¤) MUSICAL SYMBOL ONE HUNDRED TWENTY-EIGHTH NOTE => [1D158 1D165 1D172] => [1D158 1D165 1D172]
	0x1D1BD, // (ð†½) MUSICAL SYMBOL SEMIMINIMA WHITE => [1D1B9 1D165 1D16E] => [1D1B9 1D165 1D16E]
	0x1D1BE, // (ð†¾) MUSICAL SYMBOL SEMIMINIMA BLACK => [1D1BA 1D165 1D16E] => [1D1BA 1D165 1D16E]
	0x1D1BF, // (ð†¿) MUSICAL SYMBOL FUSA WHITE => [1D1B9 1D165 1D16F] => [1D1B9 1D165 1D16F]
	0x1D1C0, // (ð‡€) MUSICAL SYMBOL FUSA BLACK => [1D1BA 1D165 1D16F] => [1D1BA 1D165 1D16F]
];


chars = [...new Set(chars)];
console.log(chars);
console.log(chars.length);

let out_dir = new URL('./output/', import.meta.url);
mkdirSync(out_dir, {recursive: true});

let buckets = chars.map(() => []);
for (let label of LABELS) {
	let cps = explode_cp(label);
	for (let i = 0; i < chars.length; i++) {
		if (cps.includes(chars[i])) {
			buckets[i].push(label);
		}
	}
}

let tally = Object.fromEntries(chars.map((cp, i) => [`${hex_cp(cp)} ${String.fromCodePoint(cp)}`, buckets[i].length]))
let valid = [...new Set(buckets.flat())].filter(s => {
	try {
		ens_normalize(s);
		return true;
	} catch (err) {		
	}
});

console.log(tally);
console.log({
	total: buckets.reduce((a, x) => a + x.length, 0),
	valid: valid.length
});

let hash = createHash('sha256').update(String.fromCodePoint(...chars)).digest().toString('hex').slice(2, 10);
writeFileSync(new URL(`./frequency-${hash}.json`, out_dir), JSON.stringify({tally, valid}, null, '\t'));
console.log(`Hash: ${hash}`);
